var O365;(function(n){var t;(function(n){var u=function(){function n(){if(this.isInit=!1,n.instance)throw new Error("Error: Instantiation failed: Use ClientInstrument.getInstance() instead of new.");}return n.getInstance=function(){return n.instance===null&&(n.instance=new n),n.instance},n.prototype.init=function(){this.isInit||(this.bindClicks(),this.isInit=!0)},n.prototype.logClick=function(n){var i,r,u;n=$(n),i=this.getHint(n),i=this.refineHint(i),r=this.getValue(n),u=new t(i,r),u.log(),event.stopPropagation()},n.prototype.logClickAndData=function(n,i){var r,u;n=$(n),r=this.getHint(n),r=this.refineHint(r),u=new t(r,i),u.log()},n.prototype.logClickAndValue=function(n){var i,r,u;n=$(n),i=this.getHint(n),i=this.refineHint(i),r=this.getValue(n),u=new t(i,r),u.log()},n.prototype.logClientDataAndValue=function(n,i){var r=new t(n,i);r.log()},n.prototype.logClientAction=function(n,t){var r=new i("/api/instrument/logclientaction",n,t);r.log()},n.prototype.raisePersonalizationEvent=function(n,t){var r=new i("/api/instrument/raisepersonalizationevent",n,t);r.raiseEvent()},n.prototype.logMessage=function(n,t,i,u,f,e,o){var s=new r(n,t,i,u,f,e,o);s.writeLog()},n.prototype.logError=function(n,t,i,u){var f=new r(n,t,i,u);f.writeError()},n.prototype.bindClicks=function(){var n=this;$(document).on("click","a",function(t){n.onClick(t)});$(document).on("change","select",function(t){n.onValueChanged(t)});$(document).on("change",":text",function(t){n.onClick(t)});$(document).on("change","textarea",function(t){n.onClick(t)});$(document).on("click","button",function(t){n.onClick(t)});$(document).on("click","input",function(t){n.onClick(t)})},n.prototype.onClick=function(n){this.logClick(n.currentTarget)},n.prototype.onValueChanged=function(n){this.logClickAndValue(n.currentTarget)},n.prototype.getHint=function(n){var t=n.attr("data-hint");return t||(t=n.attr("id")),t},n.prototype.refineHint=function(n){return this.refineHintHandler?this.refineHintHandler(n):n},n.prototype.getValue=function(n){return n.attr("data-value")},n.instance=null,n}();n.ClientInstrument=u;var i=function(){function n(n,t,i){if(this.apiEndpoint=n,this.action=t,this.extendedProperties=i,this.extendedProperties){var r=JSON.stringify(this.extendedProperties);r.length<1024&&(this.data=r)}}return n.prototype.log=function(){var n=this;this.action&&$.ajax({url:this.apiEndpoint,data:{action:this.action,data:this.data},success:function(){n.callback()},error:function(t,i,r){n.retryLog(t,i,r)}})},n.prototype.raiseEvent=function(){var n=this;this.action&&$.ajax({url:this.apiEndpoint,method:"POST",headers:{AjaxSessionKey:Shared.GetSessionCookie('AjaxSessionKey')},data:{action:this.action,data:this.data},success:function(){n.callback()},error:function(t,i,r){n.retryLog(t,i,r)}})},n.prototype.callback=function(){},n.prototype.retryLog=function(){var r=this;$.ajax({url:this.apiEndpoint,data:{action:this.action,data:this.data},success:function(){r.callback()},error:function(){r.callback()}})},n}(),t=function(){function n(n,t){this.apiEndpoint="/api/instrument/logclick",this.hint=n,this.value=t}return n.prototype.log=function(){var i=this,r,t,n;this.hint&&(r=document.getElementById("EnableAriaLogger"),r?(t="",n=window.location.hash,n&&(t=n.charAt(0)==='#'?n.substring(1):n),Admin.AriaLogger.getAriaLogger().log(t,this.hint,this.value)):$.ajax({url:this.apiEndpoint,data:{hint:this.hint,value:this.value},success:function(){i.callback()},error:function(n,t,r){i.retryLog(n,t,r)}}))},n.prototype.callback=function(){},n.prototype.retryLog=function(){var r=this;$.ajax({url:this.apiEndpoint,data:{hint:this.hint,value:this.value,retry:!0},success:function(){r.callback()},error:function(){r.callback()}})},n}(),r=function(){function n(n,t,i,r,u,f,e){this.apiEndpoint="/api/instrument/",this.logMethodName="logclientmessage",this.errorMethodName="logclienterror",this.tagId=n,this.adhoc0=t,this.adhoc1=i,this.adhoc2=r,this.adhoc3=u,this.adhoc4=f,this.adhoc5=e}return n.prototype.writeLog=function(){this.tagId&&this.write(this.apiEndpoint+this.logMethodName)},n.prototype.writeError=function(){this.tagId&&this.write(this.apiEndpoint+this.errorMethodName)},n.prototype.write=function(n){var t=this,i={tagId:this.tagId,adhoc0:this.adhoc0&&this.adhoc0.length>500?this.adhoc0.substr(1,500):this.adhoc0,adhoc1:this.adhoc1&&this.adhoc1.length>500?this.adhoc1.substr(1,500):this.adhoc1,adhoc2:this.adhoc2&&this.adhoc2.length>500?this.adhoc2.substr(1,500):this.adhoc2,adhoc3:this.adhoc3&&this.adhoc3.length>500?this.adhoc3.substr(1,500):this.adhoc3,adhoc4:this.adhoc4&&this.adhoc4.length>500?this.adhoc4.substr(1,500):this.adhoc4,adhoc5:this.adhoc5&&this.adhoc5.length>500?this.adhoc5.substr(1,500):this.adhoc5};$.ajax({url:n,data:i,success:function(n){t.callback(n,1)},error:function(n){t.callback(n,0)}})},n.prototype.callback=function(n,t){t==0&&n!=null&&console.log('Error while creating log for tagId {0} Exception:{1}',this.tagId,n.data)},n}()})(t=n.Instrument||(n.Instrument={}))})(O365||(O365={})),$(document).ready(function(){O365.Instrument.ClientInstrument.getInstance().init()})